<!DOCTYPE html>
<html lang="da">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }

    #test-banner {
      background: #ffc107;
      color: #000;
      text-align: center;
      padding: 8px;
      font-weight: bold;
    }

    h2 {
      text-align: center;
      margin: 1rem 0;
      font-size: 1.4rem;
    }

    #loading {
      text-align: center;
      margin: 1rem;
      font-size: 1rem;
    }

    .month-block {
  margin: 1rem 0;
  border-radius: 6px;
  background-color: #fff;
  overflow: hidden;
}

.toggle {
  position: sticky;
  top: 0;
  z-index: 2;
  background-color: #1976d2;
  color: white;
  padding: 0.6rem 1rem;
  font-weight: bold;
  font-size: 1.1rem;
  border: none;
  width: 100%;
  text-align: left;
}
    .month-content {
      display: none;
    }

    .month-content.active {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th, td {
      padding: 0.6rem;
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
    }

    th {
      background-color: #f0f0f0;
      text-align: left;
    }

    td.name {
      color: #00796b;
      font-weight: 500;
    }

    td.name:hover {
      text-decoration: underline;
    }

    button {
      background-color: #eeeeee;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
      cursor: pointer;
      margin: 2px;
    }

    button:hover {
      background-color: #ddd;
    }

    tr.past td {
      color: #999;
    }

    tr.today td {
      background-color: #e3f2fd;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      th, td {
        padding: 0.5rem;
        font-size: 0.85rem;
      }

      .toggle {
        font-size: 1rem;
        padding: 0.6rem;
      }

      button {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div id="test-banner">üß™ TESTVERSION ‚Äì √Ündringer her p√•virker IKKE den rigtige kalender</div>
  <h2>N√∏gleb√¶rer-kalender: Juni‚ÄìDecember 2025</h2>
  <div id="loading">‚è≥ Henter data fra server...</div>
  <div id="calendar"></div>
  <script>
  const API_URL = 'https://nglevagter-test.onrender.com';
  const months = ['januar', 'februar', 'marts', 'april', 'maj', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'december'];
  const weekdays = ['s√∏n', 'man', 'tirs', 'ons', 'tors', 'fre', 'l√∏r'];
  const year = 2025;
  const startMonth = 5;
  const currentMonth = new Date().getMonth();
  const calendarContainer = document.getElementById('calendar');

  async function fetchAssignments() {
  const res = await fetch(`${API_URL}/assignments-with-events`);
  return await res.json();
  }

  async function updateAssignment(key, value) {
    await fetch(`${API_URL}/assignments`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ day: key, name: value })
    });
  }

  function getGlobalKey(month, day) {
    return `${month + 1}-${day}`;
  }

  async function renderMonth(month) {
    const assignments = await fetchAssignments();
    const block = document.createElement('div');
    block.className = 'month-block';

    const toggle = document.createElement('button');
    toggle.className = 'toggle';
    toggle.textContent = months[month].charAt(0).toUpperCase() + months[month].slice(1);
    block.appendChild(toggle);

    const content = document.createElement('div');
    content.className = 'month-content';
    if (month === currentMonth) content.classList.add('active');

    const table = document.createElement('table');
    table.innerHTML = '<tr><th>Dato</th><th>N√∏gleb√¶rer</th><th>Begivenheder</th><th>Handling</th></tr>';

    const daysInMonth = new Date(year, month + 1, 0).getDate();

for (let day = 1; day <= daysInMonth; day++) {
  const key = getGlobalKey(month, day);
  const entryData = assignments[key] || {};
  const entry = entryData.name || "";
  const eventList = entryData.events || [];

  const dateObj = new Date(year, month, day);
  dateObj.setHours(0, 0, 0, 0);
  const weekday = weekdays[dateObj.getDay()];

  const today = new Date();
  today.setHours(0, 0, 0, 0);

  const limitDate = new Date(today);
  limitDate.setDate(today.getDate() - 3);
  if (dateObj < limitDate) continue;

  let dayClass = '';
  if (dateObj < today) dayClass = 'past';
  else if (dateObj.getTime() === today.getTime()) dayClass = 'today';

  const tr = document.createElement('tr');
  if (dayClass) tr.classList.add(dayClass);

  const tdDate = document.createElement('td');
  tdDate.textContent = `${weekday} d. ${day}.`;

  const tdName = document.createElement('td');
  const tdActions = document.createElement('td');
  const tdEvents = document.createElement('td');
  tdEvents.textContent = eventList.length > 0 ? eventList.join(', ') : '‚Äì';

  if (entry.startsWith("closed")) {
    const reason = entry.includes("::") ? entry.split("::")[1].trim() : "";
    tdName.textContent = "üîí LUKKET" + (reason ? ` ‚Äì ${reason}` : "");
    tdName.style.color = "#888";

    const reopenBtn = document.createElement("button");
    reopenBtn.textContent = "√Öbn dag";
    reopenBtn.onclick = () => reopenDate(key);
    tdActions.appendChild(reopenBtn);
  } else {
    tdName.textContent = entry || "Klik for at tilf√∏je";
    tdName.className = 'name';
    tdName.style.cursor = 'pointer';
    tdName.onclick = async () => {
      const newName = prompt(`N√∏gleb√¶rer for ${day}. ${months[month]}:`, entry || '');
      if (newName !== null) {
        await updateAssignment(key, newName.trim());
        location.reload();
      }
    };

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "üóëÔ∏è";
    deleteBtn.onclick = async () => {
      if (confirm('Vil du slette n√∏gleb√¶rer for denne dag?')) {
        await updateAssignment(key, "");
        location.reload();
      }
    };

    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Luk dag";
    closeBtn.onclick = async () => {
      const reason = prompt("Hvorfor er dagen lukket? (valgfrit)");
      if (reason !== null) {
        await updateAssignment(key, "closed::" + reason.trim());
        location.reload();
      }
    };

    tdActions.appendChild(deleteBtn);
    tdActions.appendChild(closeBtn);
  }

  tr.appendChild(tdDate);
  tr.appendChild(tdName);
  tr.appendChild(tdEvents);
  tr.appendChild(tdActions);
  table.appendChild(tr);
}

    content.appendChild(table);
    block.appendChild(content);
    toggle.addEventListener('click', () => content.classList.toggle('active'));
    calendarContainer.appendChild(block);
  }

  function reopenDate(key) {
    if (confirm("Vil du √•bne denne lukkede dag?")) {
      updateAssignment(key, "").then(() => location.reload());
    }
  }

  async function renderCalendar() {
  const loading = document.getElementById("loading");
  const calendar = document.getElementById("calendar");

  try {
    for (let m = startMonth; m <= 11; m++) {
      await renderMonth(m);
    }
    loading.style.display = "none";
  } catch (err) {
    console.error("‚ùå Fejl under hentning af data:", err);
    loading.textContent = "‚ùå Kunne ikke hente kalenderdata. Pr√∏v at opdatere siden.";
  }
}

  renderCalendar();
</script>
</body>
</html>
